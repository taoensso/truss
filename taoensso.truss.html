<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>taoensso.truss documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Truss</span> <span class="project-version">1.11.0</span></span></a></h1><div id="langs"><div class="lang current">clj</div><div class="lang"><a href="index.cljs.html">cljs</a></div></div></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="taoensso.truss.html"><div class="inner"><span>taoensso.truss</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="taoensso.truss.html#var-get-data"><div class="inner"><span>get-data</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-get-dynamic-assertion-data"><div class="inner"><span>get-dynamic-assertion-data</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-have"><div class="inner"><span>have</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-have.21"><div class="inner"><span>have!</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-have.21.3F"><div class="inner"><span>have!?</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-have.3F"><div class="inner"><span>have?</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-keep-callsite"><div class="inner"><span>keep-callsite</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-set-error-fn.21"><div class="inner"><span>set-error-fn!</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-with-data"><div class="inner"><span>with-data</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-with-dynamic-assertion-data"><div class="inner"><span>with-dynamic-assertion-data</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-with-error-fn"><div class="inner"><span>with-error-fn</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">taoensso.truss</h1><div class="doc"><pre class="plaintext">An opinionated assertions (micro) library for Clojure/Script.
</pre></div><div class="public anchor" id="var-get-data"><h3>get-data</h3><h4 class="lang current">clj</h4><h4 class="lang"><a href="taoensso.truss.cljs.html#var-get-data">cljs</a></h4><div class="usage"><code>(get-data)</code></div><div class="doc"><pre class="plaintext">Returns current value of dynamic assertion data.
</pre></div></div><div class="public anchor" id="var-get-dynamic-assertion-data"><h3>get-dynamic-assertion-data</h3><h4 class="lang current">clj</h4><h4 class="lang"><a href="taoensso.truss.cljs.html#var-get-dynamic-assertion-data">cljs</a></h4><h4 class="deprecated">deprecated in v1.7.0 (2022-11-16)</h4><div class="usage"><code>(get-dynamic-assertion-data)</code></div><div class="doc"><pre class="plaintext">Prefer `get-data`
</pre></div></div><div class="public anchor" id="var-have"><h3>have</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(have x)</code><code>(have pred (:in) x)</code><code>(have pred (:in) x &amp; more-xs)</code></div><div class="doc"><pre class="plaintext">Takes a pred and one or more vals. Tests pred against each val,
trapping errors. If any pred test fails, throws a detailed assertion error.
Otherwise returns input val/vals for convenient inline-use/binding.

Respects *assert* value so tests can be elided from production for zero
runtime costs.

Provides a small, simple, flexible feature subset to alternative tools like
clojure.spec, core.typed, prismatic/schema, etc.

  ;; Will throw a detailed error message on invariant violation:
  (fn my-fn [x] (str/trim (have string? x)))

You may attach arbitrary debug info to assertion violations like:
  `(have string? x :data {:my-arbitrary-debug-info "foo"})`

Re: use of Truss assertions within other macro bodies:
  Due to CLJ-865, call site information (e.g. line number) of
  outer macro will unfortunately be lost.

  See `keep-callsite` util for a workaround.

See also `have?`, `have!`.</pre></div></div><div class="public anchor" id="var-have.21"><h3>have!</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(have! x)</code><code>(have! pred (:in) x)</code><code>(have! pred (:in) x &amp; more-xs)</code></div><div class="doc"><pre class="plaintext">Like `have` but ignores *assert* value (so can never be elided). Useful
for important conditions in production (e.g. security checks).</pre></div></div><div class="public anchor" id="var-have.21.3F"><h3>have!?</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(have!? x)</code><code>(have!? pred (:in) x)</code><code>(have!? pred (:in) x &amp; more-xs)</code></div><div class="doc"><pre class="plaintext">Specialized cross between `have?` and `have!`. Not used often but can be
handy for semantic clarification and/or to improve multi-val performance
when the return vals aren't necessary.

**WARNING**: Do NOT use in :pre/:post conds since those are ALWAYS subject
to *assert*, directly contradicting the intention of the bang (`!`) here.</pre></div></div><div class="public anchor" id="var-have.3F"><h3>have?</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(have? x)</code><code>(have? pred (:in) x)</code><code>(have? pred (:in) x &amp; more-xs)</code></div><div class="doc"><pre class="plaintext">Like `have` but returns `true` on successful tests. In particular, this
can be handy for use with :pre/:post conditions. Compare:
  (fn my-fn [x] {:post [(have  nil? %)]} nil) ; {:post [nil]} FAILS
  (fn my-fn [x] {:post [(have? nil? %)]} nil) ; {:post [true]} passes as intended</pre></div></div><div class="public anchor" id="var-keep-callsite"><h3>keep-callsite</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><h4 class="added">added in v1.8.0 (2022-12-13)</h4><div class="usage"><code>(keep-callsite &amp; body)</code></div><div class="doc"><pre class="plaintext">CLJ-865 unfortunately means that it's currently not possible
for an inner macro to access the &amp;form metadata of an outer macro.

This means that inner macros lose call site information like the
line number of the outer macro.

This util offers a workaround for macro authors:

  (defmacro my-macro1 [x]                `(truss/have ~x))  ; W/o  call site info
  (defmacro my-macro2 [x] (keep-callsite `(truss/have ~x))) ; With call site info</pre></div></div><div class="public anchor" id="var-set-error-fn.21"><h3>set-error-fn!</h3><h4 class="lang current">clj</h4><h4 class="lang"><a href="taoensso.truss.cljs.html#var-set-error-fn.21">cljs</a></h4><div class="usage"><code>(set-error-fn! f)</code></div><div class="doc"><pre class="plaintext">Sets the root (fn [data-map-delay]) called on invariant violations.
</pre></div></div><div class="public anchor" id="var-with-data"><h3>with-data</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(with-data data &amp; body)</code></div><div class="doc"><pre class="plaintext">Executes body with dynamic assertion data bound to given value.
This data will be included in any violation errors thrown by body.</pre></div></div><div class="public anchor" id="var-with-dynamic-assertion-data"><h3>with-dynamic-assertion-data</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><h4 class="deprecated">deprecated in v1.7.0 (2022-11-16)</h4><div class="usage"><code>(with-dynamic-assertion-data data &amp; body)</code></div><div class="doc"><pre class="plaintext">Prefer `with-data`
</pre></div></div><div class="public anchor" id="var-with-error-fn"><h3>with-error-fn</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(with-error-fn f &amp; body)</code></div><div class="doc"><pre class="plaintext"></pre></div></div></div></body></html>