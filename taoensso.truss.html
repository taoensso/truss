<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>taoensso.truss documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Truss</span> <span class="project-version">1.12.0</span></span></a></h1><div id="langs"><div class="lang current">clj</div><div class="lang"><a href="index.cljs.html">cljs</a></div></div></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="taoensso.truss.html"><div class="inner"><span>taoensso.truss</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="taoensso.truss.html#var-get-data"><div class="inner"><span>get-data</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-have"><div class="inner"><span>have</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-have.21"><div class="inner"><span>have!</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-have.21.3F"><div class="inner"><span>have!?</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-have.3F"><div class="inner"><span>have?</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-keep-callsite"><div class="inner"><span>keep-callsite</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-set-error-fn.21"><div class="inner"><span>set-error-fn!</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-with-data"><div class="inner"><span>with-data</span></div></a></li><li class="depth-1"><a href="taoensso.truss.html#var-with-error-fn"><div class="inner"><span>with-error-fn</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">taoensso.truss</h1><div class="doc"><pre class="plaintext">An opinionated assertions (micro) library for Clojure/Script.
</pre></div><div class="public anchor" id="var-get-data"><h3>get-data</h3><h4 class="lang current">clj</h4><h4 class="lang"><a href="taoensso.truss.cljs.html#var-get-data">cljs</a></h4><div class="usage"><code>(get-data)</code></div><div class="doc"><pre class="plaintext">Returns current value of dynamic assertion data.
</pre></div></div><div class="public anchor" id="var-have"><h3>have</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(have x)</code><code>(have pred (:in) x)</code><code>(have pred (:in) x &amp; more-xs)</code></div><div class="doc"><pre class="plaintext">Takes a (fn pred [x]) =&gt; truthy, and &gt;=1 vals.
Tests pred against each val,trapping errors.

If any pred test fails, throws a detailed `ExceptionInfo`.
Otherwise returns input val/s for convenient inline-use/binding.

Respects `*assert*`, so tests can be elided from production if desired
(meaning zero runtime cost).

Provides a small, simple, flexible feature subset to alternative tools like
clojure.spec, core.typed, prismatic/schema, etc.

Examples:

  (defn my-trim [x] (str/trim (have string? x)))

  ;; Attach arb optional info to violations using `:data`:
  (have string? x
    :data {:my-arbitrary-debug-info "foo"})

  ;; Assert inside collections using `:in`:
  (have string? :in ["foo" "bar"])

Regarding use within other macros:
  Due to CLJ-865, callsite info like line number of outer macro
  will be lost. See `keep-callsite` for workaround.

See also `have?`, `have!`.</pre></div></div><div class="public anchor" id="var-have.21"><h3>have!</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(have! x)</code><code>(have! pred (:in) x)</code><code>(have! pred (:in) x &amp; more-xs)</code></div><div class="doc"><pre class="plaintext">Like `have` but ignores `*assert*` value (so can never be elided!).
Useful for important conditions in production (e.g. security checks).</pre></div></div><div class="public anchor" id="var-have.21.3F"><h3>have!?</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(have!? x)</code><code>(have!? pred (:in) x)</code><code>(have!? pred (:in) x &amp; more-xs)</code></div><div class="doc"><pre class="plaintext">Returns `true` on successful tests, and ignores `*assert*` value
(so can never be elided!).

**WARNING**: Do NOT use in `:pre`/`:post` conditions since those always
respect `*assert*`, contradicting the intention of the bang (`!`) here.</pre></div></div><div class="public anchor" id="var-have.3F"><h3>have?</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(have? x)</code><code>(have? pred (:in) x)</code><code>(have? pred (:in) x &amp; more-xs)</code></div><div class="doc"><pre class="plaintext">Like `have` but returns `true` on successful tests.
Handy for `:pre`/`:post` conditions. Compare:
  ((fn my-fn [] {:post [(have  nil? %)]} nil)) ; {:post [nil ]} FAILS
  ((fn my-fn [] {:post [(have? nil? %)]} nil)) ; {:post [true]} passes as intended</pre></div></div><div class="public anchor" id="var-keep-callsite"><h3>keep-callsite</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><h4 class="added">added in v1.8.0 (2022-12-13)</h4><div class="usage"><code>(keep-callsite form)</code></div><div class="doc"><pre class="plaintext">The long-standing CLJ-865 means that it's not possible for an inner
macro to access the `&amp;form` metadata of a wrapping outer macro. This
means that wrapped macros lose calsite info, etc.

This util offers a workaround for macro authors:
  (defmacro inner [] (meta &amp;form))
  (defmacro outer [] (keep-callsite `(inner)))
  (outer) =&gt; {:keys [line column ...]}</pre></div></div><div class="public anchor" id="var-set-error-fn.21"><h3>set-error-fn!</h3><h4 class="lang current">clj</h4><h4 class="lang"><a href="taoensso.truss.cljs.html#var-set-error-fn.21">cljs</a></h4><div class="usage"><code>(set-error-fn! f)</code></div><div class="doc"><pre class="plaintext">Sets the root (fn [data-map-delay]) called on invariant violations.
</pre></div></div><div class="public anchor" id="var-with-data"><h3>with-data</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(with-data data &amp; body)</code></div><div class="doc"><pre class="plaintext">Executes body with dynamic assertion data bound to given value.
This data will be included in any violation errors thrown by body.</pre></div></div><div class="public anchor" id="var-with-error-fn"><h3>with-error-fn</h3><h4 class="type">macro</h4><h4 class="lang current">clj</h4><div class="usage"><code>(with-error-fn f &amp; body)</code></div><div class="doc"><pre class="plaintext"></pre></div></div></div></body></html>